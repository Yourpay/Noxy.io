import * as Resources from "../../../classes/Resource";
import * as Tables from "../../../classes/Table";
import Table from "../../../classes/Table";

const options: Tables.iTableOptions = {};
const columns: Tables.iTableColumns = {
  old_id:       {type: "varchar(14)", required: true, protected: true, unique_index: ["old_id"]},
  time_created: Table.generateTimeColumn("time_created"),
  time_updated: Table.generateTimeColumn()
};

@Resources.implement<Resources.iResource>()
export default class Subscription extends Resources.Constructor {
  
  public static readonly __type: string = "subscription";
  public static readonly __table: Table = new Table(Subscription, options, columns);
  
  public old_id: string;
  public time_created: number;
  public time_updated: number;
  
  constructor(object?: iNewSubscriptionObject | iOldSubscriptionObject) {
    super(object);
  }
  
}

interface iNewSubscriptionObject {
  id: string | Buffer
  old_id?: number
  time_created?: number
  time_updated?: number
}

interface iOldSubscriptionObject {
  id?: string | Buffer
  old_id: string
  time_created?: number
  time_updated?: number
}

"SET FOREIGN_KEY_CHECKS=0; CREATE TABLE IF NOT EXISTS `route` (`id` BINARY(16) NOT NULL, `subdomain` VARCHAR(64) NOT NULL, `path` VARCHAR(64) NOT NULL, `method` ENUM('GET','POST','PUT','DELETE', 'PATCH') NOT NULL, `flag_active` TINYINT(1) NOT NULL DEFAULT 0, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `route` (`subdomain`,`path`,`method`)) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `user` (`id` BINARY(16) NOT NULL, `username` VARCHAR(32) NOT NULL, `email` VARCHAR(128) NOT NULL, `salt` BINARY(64) NOT NULL, `hash` BINARY(64) NOT NULL, `time_login` BIGINT(14) NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `time_login` (`time_login`), INDEX `time_created` (`time_created`), UNIQUE INDEX `username` (`username`), UNIQUE INDEX `email` (`email`)) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `role` (`id` BINARY(16) NOT NULL, `name` VARCHAR(32) NOT NULL, `key` VARCHAR(32) NOT NULL, `user_created` BINARY(16) NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `user_created` (`user_created`), INDEX `time_created` (`time_created`), UNIQUE INDEX `key` (`key`), CONSTRAINT `role:user_created` FOREIGN KEY (`user_created`) REFERENCES `master`.`user` (`id`) ON UPDATE CASCADE ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `card/type` (`id` BINARY(16) NOT NULL, `name` VARCHAR(64) NOT NULL, `pattern` VARCHAR(12) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `pattern` (`pattern`)) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `psp/finder` (`id` BINARY(16) NOT NULL, `psp_id` BINARY(16) NOT NULL, `amount` INT(11) NOT NULL, `currency_id` VARCHAR(3) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `psp` (`psp_id`), CONSTRAINT `psp/finder:psp_id` FOREIGN KEY (`psp_id`) REFERENCES `master`.`psp` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `psp/kickback` (`id` BINARY(16) NOT NULL, `psp_id` BINARY(16) NOT NULL, `percentage` DECIMAL(6,3) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `psp` (`psp_id`), CONSTRAINT `psp/kickback:psp_id` FOREIGN KEY (`psp_id`) REFERENCES `master`.`psp` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `psp` (`id` BINARY(16) NOT NULL, `old_id` INT(11) NOT NULL, `name` VARCHAR(128) NOT NULL, `contact` VARCHAR(128) NOT NULL, `volume` INT(11) NOT NULL, `settlement_days` INT(3) NOT NULL, `percentage` DECIMAL(5,2) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `old_id` (`old_id`)) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `institution` (`id` BINARY(16) NOT NULL, `name` VARCHAR(128) NOT NULL, `old_id` TINYINT(3) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `name` (`name`), UNIQUE INDEX `old_id` (`old_id`)) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `role/route` (`role_id` BINARY(16) NOT NULL, `route_id` BINARY(16) NOT NULL, PRIMARY KEY (`role_id`,`route_id`), INDEX `role_id` (`role_id`), INDEX `route_id` (`route_id`), CONSTRAINT `role/route:role_id` FOREIGN KEY (`role_id`) REFERENCES `master`.`role` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT `role/route:route_id` FOREIGN KEY (`route_id`) REFERENCES `master`.`route` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `role/user` (`role_id` BINARY(16) NOT NULL, `user_id` BINARY(16) NOT NULL, PRIMARY KEY (`role_id`,`user_id`), INDEX `role_id` (`role_id`), INDEX `user_id` (`user_id`), CONSTRAINT `role/user:role_id` FOREIGN KEY (`role_id`) REFERENCES `master`.`role` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT `role/user:user_id` FOREIGN KEY (`user_id`) REFERENCES `master`.`user` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `app` (`id` BINARY(16) NOT NULL, `name` VARCHAR(64) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `app` (`name`)) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `card` (`id` BINARY(16) NOT NULL, `type_id` BINARY(16) NOT NULL, `name` VARCHAR(64) NOT NULL, `number` VARCHAR(16) NOT NULL, `country_id` VARCHAR(3) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `card/type` (`type_id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `card` (`name`,`number`), CONSTRAINT `card:type_id` FOREIGN KEY (`type_id`) REFERENCES `master`.`card/type` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `merchant/hierarchy` (`merchant_id` BINARY(16) NOT NULL, `master_id` BINARY(16) NOT NULL, `superior_id` BINARY(16) NOT NULL, PRIMARY KEY (`merchant_id`,`master_id`,`superior_id`), INDEX `merchant_id` (`merchant_id`), INDEX `master_id` (`master_id`), INDEX `superior_id` (`superior_id`), CONSTRAINT `merchant/hierarchy:merchant_id` FOREIGN KEY (`merchant_id`) REFERENCES `master`.`merchant` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT `merchant/hierarchy:master_id` FOREIGN KEY (`master_id`) REFERENCES `master`.`merchant` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT `merchant/hierarchy:superior_id` FOREIGN KEY (`superior_id`) REFERENCES `master`.`merchant` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `merchant` (`id` BINARY(16) NOT NULL, `psp_id` BINARY(16) NOT NULL, `old_id` INT(11) NOT NULL, `cvr` VARCHAR(12) NOT NULL, `name` VARCHAR(128) NOT NULL, `address` VARCHAR(64) NOT NULL, `city` VARCHAR(64) NOT NULL, `postal` VARCHAR(12) NOT NULL, `country` VARCHAR(84) NOT NULL, `phone` VARCHAR(32) NOT NULL, `website` VARCHAR(128) NOT NULL, `logo` TEXT NOT NULL, `type_login` TINYINT(1) NOT NULL, `mcc` SMALLINT(4) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `old_id` (`old_id`), CONSTRAINT `merchant:psp_id` FOREIGN KEY (`psp_id`) REFERENCES `master`.`psp` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `platform` (`id` BINARY(16) NOT NULL, `name` VARCHAR(64) NOT NULL, `domain` VARCHAR(64) NOT NULL, `version` VARCHAR(15) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `platform` (`name`,`domain`,`version`)) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `payment/capture` (`id` BINARY(16) NOT NULL, `amount` INT(11) NOT NULL, `payment_id` BINARY(16) NOT NULL, `old_id` INT(11) NOT NULL, `flag_processed` TINYINT(1) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `pattern` (`payment_id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `old_id` (`old_id`), CONSTRAINT `payment/capture:payment_id` FOREIGN KEY (`payment_id`) REFERENCES `master`.`payment` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `payment/refund` (`id` BINARY(16) NOT NULL, `amount` INT(11) NOT NULL, `payment_id` BINARY(16) NOT NULL, `old_id` INT(11) NOT NULL, `flag_processed` TINYINT(1) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `pattern` (`payment_id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `old_id` (`old_id`), CONSTRAINT `payment/refund:payment_id` FOREIGN KEY (`payment_id`) REFERENCES `master`.`payment` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `payment/release` (`id` BINARY(16) NOT NULL, `payment_id` BINARY(16) NOT NULL, `old_id` INT(11) NOT NULL, `flag_processed` TINYINT(1) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `pattern` (`payment_id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `old_id` (`old_id`), CONSTRAINT `payment/release:payment_id` FOREIGN KEY (`payment_id`) REFERENCES `master`.`payment` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `payment/failure` (`id` BINARY(16) NOT NULL, `amount` INT(11) NOT NULL, `payment_id` BINARY(16) NOT NULL, `old_id` INT(11) NOT NULL, `flag_processed` TINYINT(1) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `pattern` (`payment_id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `old_id` (`old_id`), CONSTRAINT `payment/failure:payment_id` FOREIGN KEY (`payment_id`) REFERENCES `master`.`payment` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `payment/fee` (`id` BINARY(16) NOT NULL, `payment_id` BINARY(16) NOT NULL, `old_id` INT(11) NOT NULL, `amount` INT(11) NOT NULL, `percentage` DECIMAL(5,4) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `pattern` (`payment_id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `old_id` (`old_id`), CONSTRAINT `payment/fee:payment_id` FOREIGN KEY (`payment_id`) REFERENCES `master`.`payment` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `subscription` (`id` BINARY(16) NOT NULL, `old_id` VARCHAR(14) NOT NULL, `time_created` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `old_id` (`old_id`)) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `payment/subscription` (`payment_id` BINARY(16) NOT NULL, `subscription_id` BINARY(16) NOT NULL, PRIMARY KEY (), INDEX `payment_id` (`payment_id`), INDEX `subscription_id` (`subscription_id`), CONSTRAINT `payment/subscription:payment_id` FOREIGN KEY (`payment_id`) REFERENCES `master`.`payment` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT `payment/subscription:subscription_id` FOREIGN KEY (`subscription_id`) REFERENCES `master`.`subscription` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; CREATE TABLE IF NOT EXISTS `payment` (`id` BINARY(16) NOT NULL, `amount` INT(11) NOT NULL, `currency_id` VARCHAR(3) NOT NULL DEFAULT 208, `order_id` VARCHAR(64) NOT NULL, `old_id` INT(11) NOT NULL, `card_id` BINARY(16) NOT NULL, `platform_id` BINARY(16) NOT NULL, `institution_id` BINARY(16) NOT NULL, `cde_id` VARCHAR(64) NOT NULL, `short_id` VARCHAR(15) NOT NULL, `flag_test` TINYINT(1) NOT NULL DEFAULT 1, `flag_pos` TINYINT(1) NOT NULL, `flag_fee` TINYINT(1) NOT NULL, `flag_secure` TINYINT(1) NOT NULL, `time_created` BIGINT(14) NULL, `time_captured` BIGINT(14) NULL, `time_refunded` BIGINT(14) NULL, `time_released` BIGINT(14) NULL, `time_updated` BIGINT(14) NULL, PRIMARY KEY (`id`), INDEX `card` (`card_id`), INDEX `platform` (`platform_id`), INDEX `institution` (`institution_id`), INDEX `time_created` (`time_created`), UNIQUE INDEX `old_id` (`old_id`), CONSTRAINT `payment:card_id` FOREIGN KEY (`card_id`) REFERENCES `master`.`card` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT `payment:platform_id` FOREIGN KEY (`platform_id`) REFERENCES `master`.`platform` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT `payment:institution_id` FOREIGN KEY (`institution_id`) REFERENCES `master`.`institution` (`id`) ON UPDATE NO ACTION ON DELETE NO ACTION) ENGINE=InnoDB COLLATE='utf8mb4_unicode_ci'; SET FOREIGN_KEY_CHECKS=1;";


